local beingrobbed = false
	local Canberobbed = true
	local DeathCoolDown = Customisable.DeathCooldown
	local RobCoolDown = Customisable.RobCooldown
	local IdleAnimRobbed = target.Parent.Parent.Cashier.Humanoid:LoadAnimation(script.IdleRobbed)
	local RobAnim = target.Parent.Parent.Cashier.Humanoid:LoadAnimation(script.Robbed)
	local HitAnim = target.Parent.Parent.Cashier.Humanoid:LoadAnimation(script.Damaged)
	local DeadAnim = target.Parent.Parent.Cashier.Humanoid:LoadAnimation(script.Died)
	local DeadDmgAnim = target.Parent.Parent.Cashier.Humanoid:LoadAnimation(script.DiedHit)
	local oldhp = target.Parent.Parent.Cashier.Humanoid.Health

	target.Parent.Parent.TrashBag.Transparency = 1
	target.Parent.Parent.Cashier.Cash.Transparency = 1
	target.Parent.Parent.Cashier.TrashBag.Transparency = 1
	HitAnim.Priority = Enum.AnimationPriority.Action3
	DeadAnim.Priority = Enum.AnimationPriority.Action4
	RobAnim.Priority = Enum.AnimationPriority.Action2
	DeadDmgAnim.Priority = Enum.AnimationPriority.Action4
	IdleAnimRobbed.Priority = Enum.AnimationPriority.Action2

	target.Parent.Parent.Cashier.Humanoid.HealthChanged:Connect(function()
		if oldhp > target.Parent.Parent.Cashier.Humanoid.Health then
			HitAnim:Play()
			oldhp = target.Parent.Parent.Cashier.Humanoid.Health
		end
		if target.Parent.Parent.Cashier.Humanoid.Health <= 1 then
			target.Parent.Parent.Cashier.Humanoid.Health = 1.1
			if not DeadAnim.IsPlaying then
				target.Parent.Parent.Cashier.Cash.Transparency = 1
				target.Parent.Parent.Cashier.TrashBag.Transparency = 1
				Canberobbed = false
				DeadAnim:Play()
				IdleAnimRobbed:Stop()
				DeadAnim:GetMarkerReachedSignal("End"):Wait()
				DeadAnim:AdjustSpeed(0)
				RobAnim:Stop()	
				beingrobbed = false
				wait(DeathCoolDown)
				Canberobbed = true
				target.Parent.Parent.Cashier.Humanoid.Health = target.Parent.Parent.Cashier.Humanoid.MaxHealth
				DeadDmgAnim:Stop()
				DeadAnim:Stop()
			else
				DeadDmgAnim:Play()
			end
		end
	end)

	local cd = target.Parent.Parent.TrashBag:FindFirstChildOfClass("ClickDetector")
	cd.MouseClick:Connect(function(plr)
		Customisable.CashbagOpened(cd.Parent, plr)
	end)

	local function initiateRobbery()
		beingrobbed = true
		target.Parent.Parent.TrashBag.Amount.Value = math.random(Customisable.MinMaxCash[1], Customisable.MinMaxCash[2])
		target.Parent.Parent.TrashBag.BillboardGui.Cash.Text = "$" .. target.Parent.Parent.TrashBag.Amount.Value
		local anim = RobAnim
		anim.Priority = Enum.AnimationPriority.Action2
		anim:Play()
		anim:GetMarkerReachedSignal("Tools"):Wait()
		target.Parent.Parent.Cashier.TrashBag.Transparency = 0
		target.Parent.Parent.Cashier.Cash.Transparency = 0
		anim:GetMarkerReachedSignal("NoCash"):Wait()
		target.Parent.Parent.Cashier.Cash.Transparency = 1
		anim:GetMarkerReachedSignal("Bag"):Wait()
		target.Parent.Parent.Cashier.TrashBag.Transparency = 1
		target.Parent.Parent.TrashBag.BillboardGui.Enabled = true
		target.Parent.Parent.TrashBag.Transparency = 0
		anim:GetMarkerReachedSignal("End"):Wait()
		IdleAnimRobbed:Play()

		delay(RobCoolDown, function()
			target.Parent.Parent.TrashBag.Transparency = 1
			target.Parent.Parent.Cashier.Cash.Transparency = 1
			target.Parent.Parent.TrashBag.BillboardGui.Enabled = false
			target.Parent.Parent.Cashier.TrashBag.Transparency = 1
			beingrobbed = false
			IdleAnimRobbed:Stop()
		end)
	end

	while true do
		if Canberobbed and not beingrobbed then
			for _, player in pairs(Players:GetPlayers()) do
				local character = player.Character
				if character and (character.PrimaryPart.Position - target.Parent.Parent.Cashier.HumanoidRootPart.Position).Magnitude <= 20 then
					local hasDangerousTool = false
					for _, tool in pairs(character:GetChildren()) do
						if tool:IsA("Tool") and tool:HasTag("Dangerous") then
							hasDangerousTool = true
							break
						end
					end
					if hasDangerousTool then
						initiateRobbery()
						break
					end
				end
			end
		end
		wait(.5) 
	end
